<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/gulp-plugin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/gulp-plugin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
const path = require('path');
const gutil = require('gulp-util');
const through2 = require('through2');
const marked = require('marked');
const process = require('./md-vega');

/**
 * @module
 */
/**
 * [gulp]{@link https://gulpjs.com} plugin to replace [marked-vega]{@link https://www.webcomponents.org/element/PolymerVis/marked-vega}
 * codeblocks with base64 image markdown tags so that any markdown parser can
 * render the Vega or Vega-Lite charts as images.
 * If no `markedOpts` is passed as argument, the plugin will just replace the
 * `marked-vega` codeblocks - the output file will still be in markdown.
 * Otherwise, the plugin will replace and render the file as HTML using [marked]{@link https://github.com/chjj/marked} lib.
 * @param {{renderer: Function, gfm: Boolean, tables: Boolean, breaks: Boolean, pedantic: Boolean, sanitize: Boolean, smartLists: Boolean, smartypants: Boolean}} markedOpts Options to pass to `marked`.
 * @return {stream.Transform}
 * @example
 * const gulp = require('gulp');
 * const marked_vega = require('gulp-marked-vega');
 *
 * gulp
 *   .src('./test/sample.md')
 *   .pipe(marked_vega())
 *   .pipe(gulp.dest('test/output'));
 */
function plugin(markedOpts) {
  return through2.obj(function Parser(file, enc, cb) {
    if (file.isNull()) {
      cb(null, file);
      return;
    }

    if (file.isStream()) {
      cb(new gutil.PluginError('gulp-marked-vega', 'Streaming not supported'));
      return;
    }

    process(file.contents.toString())
      .then(text => {
        if (markedOpts) {
          marked.setOptions(markedOpts === true ? {} : markedOpts);
          text = marked(text);
          let dir = path.dirname(file.path);
          let filename = path.basename(file.path, path.extname(file.path));
          file.path = path.join(dir, filename + '.html');
        }
        file.contents = new Buffer(text);
        this.push(file);
        cb();
      })
      .catch(err => {
        this.emit(
          'error',
          new gutil.PluginError('gulp-marked-vega', err, {fileName: file.path})
        );
      });
  });
}

module.exports = plugin;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-gulp-marked-vega.html">gulp-marked-vega</a></li><li><a href="module-lib_gulp-plugin.html">lib/gulp-plugin</a></li><li><a href="module-lib_md-fence.html">lib/md-fence</a></li><li><a href="module-lib_md-vega.html">lib/md-vega</a></li></ul><h3>Classes</h3><ul><li><a href="module-lib_md-fence-MdFence.html">MdFence</a></li><li><a href="module-lib_md-fence-TextFeed.html">TextFeed</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Nov 04 2017 13:31:14 GMT+0800 (DST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
